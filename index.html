<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Gest√£o Acad√™mica Pro</title>
    <style>
      :root {
        --primary: #1e293b;
        --dc1: #ef4444;
        --dp2: #3b82f6;
        --dc2: #10b981;
        --sj: #f59e0b;
        --eco: #8b5cf6;
        --lj: #64748b;
        --cdc: #eab308;
        --bg: #f1f5f9;
        --prova: #fbbf24;
      }
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        outline: none;
      }
      body {
        font-family: "Inter", sans-serif;
        background: var(--bg);
        margin: 0;
        color: var(--primary);
        padding-bottom: 50px;
        user-select: none;
      }
      .sticky-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 12px;
        border-bottom: 1px solid #e2e8f0;
      }
      .alerta-provas {
        display: none;
        background: #fffbeb;
        border-left: 5px solid var(--prova);
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 12px;
        font-size: 0.65rem;
        color: #92400e;
        font-weight: 800;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      .alerta-item {
        margin-bottom: 4px;
        display: block;
        border-bottom: 1px dashed rgba(251, 191, 36, 0.3);
        padding-bottom: 2px;
      }
      .alerta-item:last-child {
        border: none;
      }
      .stats-text {
        display: flex;
        justify-content: space-between;
        font-size: 0.6rem;
        font-weight: 900;
      }
      .barra-bg {
        background: #e2e8f0;
        height: 8px;
        border-radius: 10px;
        overflow: hidden;
        margin: 8px 0;
      }
      .barra-fill {
        background: linear-gradient(90deg, #10b981, #3b82f6);
        height: 100%;
        width: 0%;
        transition: width 1s ease;
      }
      .filtro-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
        margin-top: 10px;
      }
      .btn-filtro {
        padding: 8px 4px;
        border-radius: 8px;
        border: 2px solid #e2e8f0;
        background: #fff;
        color: #64748b;
        font-size: 0.58rem;
        font-weight: 700;
        cursor: pointer;
      }
      .btn-full {
        grid-column: span 2;
        background: var(--primary) !important;
        color: white !important;
        border: none !important;
      }
      .container {
        padding: 10px;
      }
      .grid-mes {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        background: #fff;
        padding: 12px;
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
        margin-bottom: 30px;
      }
      .mes-titulo {
        grid-column: span 7;
        font-size: 1rem;
        font-weight: 900;
        text-align: center;
        padding: 15px 0;
        text-transform: uppercase;
      }
      .dow {
        font-weight: 800;
        text-align: center;
        font-size: 0.5rem;
        color: #cbd5e1;
        padding-bottom: 8px;
      }
      .dia {
        min-height: 95px;
        border: 1.5px solid #f8fafc;
        border-radius: 12px;
        padding: 5px;
        position: relative;
        transition: 0.3s;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
      }
      .dia.hoje {
        border: 2px solid #3b82f6 !important;
        background: #f0f7ff !important;
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.2);
      }
      .dia.passado {
        opacity: 0.6;
        background: #fcfcfc;
      }
      .dia-num {
        font-weight: 700;
        font-size: 0.85rem;
        color: #94a3b8;
        margin-bottom: 2px;
      }
      .dia.prova-topo {
        border-top: 4px solid var(--prova) !important;
        background: #fffbeb;
      }
      .dia.prova-topo::before {
        content: "‚ö†Ô∏è PROVA";
        position: absolute;
        top: -10px;
        right: 2px;
        font-size: 0.38rem;
        background: var(--prova);
        color: #fff;
        padding: 1px 4px;
        border-radius: 3px;
        font-weight: 900;
        z-index: 10;
      }
      .dia.prova-baixo {
        border-bottom: 4px solid var(--prova) !important;
        background: #fffbeb;
      }
      .dia.prova-baixo::after {
        content: "‚ö†Ô∏è PROVA";
        position: absolute;
        bottom: -10px;
        right: 2px;
        font-size: 0.38rem;
        background: var(--prova);
        color: #fff;
        padding: 1px 4px;
        border-radius: 3px;
        font-weight: 900;
        z-index: 10;
      }
      .tag {
        font-size: 0.45rem;
        padding: 4px 2px;
        border-radius: 5px;
        color: #fff;
        font-weight: 700;
        text-align: center;
        cursor: pointer;
        margin-bottom: 3px;
        position: relative;
        line-height: 1.1;
        overflow: hidden;
      }
      .tag::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 0%;
        background: rgba(255, 255, 255, 0.4);
        pointer-events: none;
      }
      .tag.holding::before {
        width: 100%;
        transition: width 0.6s linear;
      }
      .tag span {
        display: block;
        font-size: 0.35rem;
        opacity: 0.8;
        margin-bottom: 1px;
      }
      .tag.com-falta::after {
        content: "‚úï";
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 900;
        border-radius: 5px;
      }
      .dia.esmaecido {
        opacity: 0.05 !important;
        filter: grayscale(1);
      }
      .legenda-topo {
        display: grid;
        grid-template-columns: 1fr 45px 45px;
        gap: 10px;
        padding: 0 15px 5px 15px;
        margin-top: 15px;
      }
      .legenda-topo span {
        font-size: 0.5rem;
        font-weight: 900;
        color: #94a3b8;
        text-transform: uppercase;
      }
      .painel-faltas {
        background: #fff;
        padding: 12px;
        border-radius: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.02);
      }
      .materia-row {
        padding: 10px;
        background: #f8fafc;
        border-radius: 12px;
        margin-bottom: 8px;
        display: grid;
        grid-template-columns: 1fr 45px 45px;
        align-items: center;
        gap: 10px;
      }
      .materia-info b {
        font-size: 0.7rem;
        font-weight: 800;
        display: block;
      }
      .materia-info span {
        font-size: 0.55rem;
        color: #64748b;
      }
      .td-count {
        font-weight: 900;
        font-size: 0.85rem;
        text-align: center;
        padding: 5px;
        border-radius: 8px;
      }
      .status-limite-proximo {
        background: #fff7ed !important;
        color: #ea580c !important;
        border: 1px solid #fdba74 !important;
      }
      .status-perigo {
        background: #fef2f2 !important;
        color: #ef4444 !important;
        border: 1px solid #fca5a5 !important;
        animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.6;
        }
        100% {
          opacity: 1;
        }
      }
      .recesso-nome {
        font-size: 0.4rem;
        font-weight: 800;
        color: #94a3b8;
        text-transform: uppercase;
        margin-top: auto;
        padding-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="sticky-header">
      <div id="alerta-box" class="alerta-provas"></div>
      <div class="stats-text">
        <span>CONCLU√çDO: <span id="perc-num">0%</span></span
        ><span>AULAS RESTANTES: <span id="aulas-restantes">0</span></span>
      </div>
      <div class="barra-bg"><div class="barra-fill" id="barra-fill"></div></div>
      <div class="filtro-grid" id="menu-filtros">
        <button
          class="btn-filtro active btn-full"
          id="btn-todas"
          onclick="limparFiltro(this)"
        >
          VISUALIZAR TODAS AS DISCIPLINAS
        </button>
      </div>
    </div>

    <div class="container" id="calendario-container"></div>

    <div class="container">
      <div class="legenda-topo">
        <span>Mat√©ria</span><span style="text-align: center">Faltas</span
        ><span style="text-align: center">Limite</span>
      </div>
      <div class="painel-faltas"><div id="relatorio-lista"></div></div>
    </div>

    <script>
      const MATERIAS = {
        DC1: { n: "DIREITO CONST. I", h: 80, c: "var(--dc1)" },
        DP2: { n: "DIREITO PENAL II", h: 80, c: "var(--dp2)" },
        DC2: { n: "DIREITO CIVIL II", h: 80, c: "var(--dc2)" },
        SJ: { n: "SOCIO. JUR√çDICA", h: 40, c: "var(--sj)" },
        ECO: { n: "ECONOMIA", h: 40, c: "var(--eco)" },
        LJ: { n: "LING. JUR√çDICA", h: 40, c: "var(--lj)" },
        CDC: { n: "CULTURA E CIDAD.", h: 40, c: "var(--cdc)" },
      };

      const FERIADOS = {
        "2026-02-16": "Recesso",
        "2026-02-17": "Carnaval",
        "2026-02-18": "Cinzas",
        "2026-04-03": "Paix√£o",
        "2026-04-21": "Tiradentes",
        "2026-05-01": "Trabalho",
        "2026-06-04": "Corpus Christi",
      };

      const CONFIG_MESES = [
        { id: 1, nome: "Fevereiro", dias: 28, start: 0, ano: 2026 },
        { id: 2, nome: "Mar√ßo", dias: 31, start: 0, ano: 2026 },
        { id: 3, nome: "Abril", dias: 30, start: 3, ano: 2026 },
        { id: 4, nome: "Maio", dias: 31, start: 5, ano: 2026 },
        { id: 5, nome: "Junho", dias: 30, start: 1, ano: 2026 },
        { id: 6, nome: "Julho", dias: 5, start: 3, ano: 2026 },
      ];

      let faltasDb =
        JSON.parse(localStorage.getItem("faltas_vfinal_2026")) || [];
      let provasDb =
        JSON.parse(localStorage.getItem("provas_vfinal_2026_pos")) || [];
      let timer;
      let materiasSelecionadas = [];

      function gerarCalendario() {
        const container = document.getElementById("calendario-container");
        container.innerHTML = "";
        CONFIG_MESES.forEach((m) => {
          let html = `<div class="grid-mes" data-mes="${m.id}" data-nome="${m.nome}">
                <div class="mes-titulo">${m.nome} 2026</div>
                <div class="dow">DOM</div><div class="dow">SEG</div><div class="dow">TER</div><div class="dow">QUA</div><div class="dow">QUI</div><div class="dow">SEX</div><div class="dow">S√ÅB</div>`;
          for (let i = 0; i < m.start; i++) html += `<div class="dia"></div>`;
          for (let d = 1; d <= m.dias; d++) {
            const dataIso = `${m.ano}-${String(m.id + 1).padStart(
              2,
              "0"
            )}-${String(d).padStart(2, "0")}`;
            const diaSemana = (m.start + d - 1) % 7;
            let tagsHtml = "",
              recessoHtml = FERIADOS[dataIso]
                ? `<span class="recesso-nome">${FERIADOS[dataIso]}</span>`
                : "";

            if (!FERIADOS[dataIso] && (m.id > 1 || (m.id === 1 && d >= 9))) {
              if (diaSemana === 1) {
                tagsHtml +=
                  criarTag("18:40", "DC1", "topo") +
                  criarTag("20:30", "DC2", "baixo");
              } else if (diaSemana === 2) {
                tagsHtml +=
                  criarTag("18:40", "DP2", "topo") +
                  criarTag("20:30", "DC1", "baixo");
              } else if (diaSemana === 3) {
                tagsHtml +=
                  criarTag("18:40", "DP2", "topo") +
                  criarTag("20:30", "ECO", "baixo");
              } else if (diaSemana === 4) {
                tagsHtml +=
                  criarTag("18:40", "SJ", "topo") +
                  criarTag("20:30", "DC2", "baixo");
              } else if (diaSemana === 5) {
                // L√ìGICA CORRIGIDA: CDC s√≥ come√ßa em 15/05/2026
                const dataAtualObj = new Date(dataIso + "T00:00:00");
                const dataInicioCDC = new Date("2026-05-15T00:00:00");
                if (dataAtualObj >= dataInicioCDC) {
                  tagsHtml += criarTag("19:30", "CDC", "topo");
                }
                tagsHtml += criarTag("20:30", "LJ", "baixo");
              }
            }
            html += `<div class="dia" data-dia="${d}" data-date="${dataIso}"><span class="dia-num">${d}</span>${tagsHtml}${recessoHtml}</div>`;
          }
          html += `</div>`;
          container.innerHTML += html;
        });
      }

      function criarTag(hora, cod, pos) {
        return `<div class="tag" style="background:${MATERIAS[cod].c}" data-materia="${cod}" data-pos="${pos}"
                onmousedown="startHold(this, '${cod}', '${pos}')" onmouseup="endHold(this, '${cod}')" 
                ontouchstart="startHold(this, '${cod}', '${pos}')" ontouchend="endHold(this, '${cod}')">
                <span>${hora}</span>${MATERIAS[cod].n}</div>`;
      }

      function startHold(el, cod, pos) {
        el.classList.add("holding");
        timer = setTimeout(() => {
          const dataIso = el.closest(".dia").dataset.date;
          const idProva = `${dataIso}-${cod}-${pos}`;
          provasDb = provasDb.includes(idProva)
            ? provasDb.filter((i) => i !== idProva)
            : [...provasDb, idProva];
          localStorage.setItem(
            "provas_vfinal_2026_pos",
            JSON.stringify(provasDb)
          );
          el.dataset.hold = "true";
          el.classList.remove("holding");
          renderizar();
        }, 600);
      }

      function endHold(el, cod) {
        el.classList.remove("holding");
        if (el.dataset.hold === "true") {
          delete el.dataset.hold;
          clearTimeout(timer);
          return;
        }
        clearTimeout(timer);
        const id = `${el.closest(".grid-mes").dataset.nome}-${
          el.closest(".dia").dataset.dia
        }-${cod}`;
        faltasDb = faltasDb.includes(id)
          ? faltasDb.filter((i) => i !== id)
          : [...faltasDb, id];
        localStorage.setItem("faltas_vfinal_2026", JSON.stringify(faltasDb));
        renderizar();
      }

      function filtrarMateria(cod, btn) {
        const btnTodas = document.getElementById("btn-todas");
        if (materiasSelecionadas.includes(cod)) {
          materiasSelecionadas = materiasSelecionadas.filter((m) => m !== cod);
          btn.classList.remove("active");
          btn.style.background = "#fff";
          btn.style.color = "#64748b";
        } else {
          materiasSelecionadas.push(cod);
          btn.classList.add("active");
          btn.style.background = MATERIAS[cod].c;
          btn.style.color = "white";
        }
        if (materiasSelecionadas.length === 0) {
          limparFiltro(btnTodas);
        } else {
          btnTodas.style.opacity = "0.5";
          document.querySelectorAll(".dia").forEach((dia) => {
            if (!dia.dataset.dia) return;
            const temAlgumaSelecionada = materiasSelecionadas.some((m) =>
              dia.querySelector(`[data-materia="${m}"]`)
            );
            dia.classList.toggle("esmaecido", !temAlgumaSelecionada);
          });
        }
      }

      function limparFiltro(btn) {
        materiasSelecionadas = [];
        document.querySelectorAll(".btn-filtro").forEach((b) => {
          b.classList.remove("active");
          b.style.background = "#fff";
          b.style.color = "#64748b";
          b.style.opacity = "1";
        });
        btn.style.opacity = "1";
        document
          .querySelectorAll(".dia")
          .forEach((dia) => dia.classList.remove("esmaecido"));
      }

      function renderizar() {
        const hoje = new Date();
        hoje.setHours(0, 0, 0, 0);
        const dHoje = hoje.getDate(),
          mHoje = hoje.getMonth();
        let totS = 0,
          passS = 0;
        let provasProximas = [];
        const rel = document.getElementById("relatorio-lista");
        rel.innerHTML = "";

        Object.keys(MATERIAS).forEach((cod) => {
          const lim = MATERIAS[cod].h * 0.25;
          const cr = faltasDb.filter((id) => id.endsWith(cod)).length * 2;
          let classeStatus = "";
          if (cr >= lim) classeStatus = "status-perigo";
          else if (cr >= lim - 2) classeStatus = "status-limite-proximo";

          let aM = 0,
            pM = 0;
          document
            .querySelectorAll(`[data-materia="${cod}"]`)
            .forEach((tag) => {
              aM++;
              const mesNum = parseInt(tag.closest(".grid-mes").dataset.mes);
              const diaNum = parseInt(tag.closest(".dia").dataset.dia);
              if (mesNum < mHoje || (mesNum === mHoje && diaNum < dHoje)) pM++;
            });
          const perc = Math.round((pM / aM) * 100) || 0;
          rel.innerHTML += `<div class="materia-row"><div class="materia-info"><b>${MATERIAS[cod].n}</b><span>Progresso: ${perc}%</span></div><div class="td-count ${classeStatus}">${cr}</div><div class="td-count" style="color:#cbd5e1">${lim}</div></div>`;
        });

        document.querySelectorAll(".grid-mes").forEach((grid) => {
          const mesNum = parseInt(grid.dataset.mes);
          grid.querySelectorAll(".dia").forEach((diaDiv) => {
            const d = parseInt(diaDiv.dataset.dia);
            if (!d) return;
            const dataIso = diaDiv.dataset.date;
            const dataObj = new Date(dataIso + "T00:00:00");
            const diff = Math.ceil((dataObj - hoje) / 86400000);
            const tags = diaDiv.querySelectorAll(".tag");
            if (tags.length > 0) totS++;

            diaDiv.classList.remove(
              "hoje",
              "passado",
              "prova-topo",
              "prova-baixo"
            );
            if (mesNum === mHoje && d === dHoje) diaDiv.classList.add("hoje");
            else if (mesNum < mHoje || (mesNum === mHoje && d < dHoje)) {
              diaDiv.classList.add("passado");
              if (tags.length > 0) passS++;
            }

            tags.forEach((tag) => {
              const cod = tag.dataset.materia;
              const idF = `${grid.dataset.nome}-${d}-${cod}`;
              const idP = `${dataIso}-${cod}-${tag.dataset.pos}`;
              tag.classList.toggle("com-falta", faltasDb.includes(idF));
              if (provasDb.includes(idP)) {
                diaDiv.classList.add(
                  tag.dataset.pos === "topo" ? "prova-topo" : "prova-baixo"
                );
                if (diff >= 0 && diff <= 7)
                  provasProximas.push(
                    `‚Ä¢ ${MATERIAS[cod].n} (${d} de ${grid.dataset.nome})`
                  );
              }
            });
          });
        });

        const alertaBox = document.getElementById("alerta-box");
        if (provasProximas.length > 0) {
          alertaBox.style.display = "block";
          alertaBox.innerHTML =
            `üö® <b>PROVAS NOS PR√ìXIMOS 7 DIAS:</b><br>` +
            provasProximas
              .map((p) => `<span class="alerta-item">${p}</span>`)
              .join("");
        } else alertaBox.style.display = "none";

        const percGeral = Math.round((passS / totS) * 100) || 0;
        document.getElementById("barra-fill").style.width = percGeral + "%";
        document.getElementById("perc-num").innerText = percGeral + "%";
        document.getElementById("aulas-restantes").innerText = totS - passS;
      }

      window.onload = () => {
        gerarCalendario();
        const menu = document.getElementById("menu-filtros");
        Object.keys(MATERIAS).forEach((cod) => {
          const btn = document.createElement("button");
          btn.className = `btn-filtro`;
          btn.innerText = MATERIAS[cod].n;
          btn.style.borderColor = MATERIAS[cod].c;
          btn.onclick = () => filtrarMateria(cod, btn);
          menu.appendChild(btn);
        });
        renderizar();
      };
    </script>
  </body>
</html>
